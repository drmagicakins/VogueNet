{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto bg-white shadow p-6 mt-8 rounded">
  <h1 class="text-2xl font-bold mb-4">ğŸ› Upload Product</h1>

  <form id="uploadForm" class="space-y-4" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="Product Name" class="w-full p-2 border rounded" required />
    <textarea name="description" placeholder="Product Description" class="w-full p-2 border rounded" required></textarea>
    <input type="number" name="price" placeholder="Price (â‚¦)" class="w-full p-2 border rounded" required />
    <input type="file" name="image" class="w-full p-2 border rounded bg-white" required />
    <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 w-full">
      Upload Product
    </button>
  </form>

  <p id="status" class="text-center mt-4 text-gray-600 font-semibold"></p>
</div>

<script>
  const form = document.getElementById("uploadForm");
  const status = document.getElementById("status");
  const token = localStorage.getItem("token");

  form.onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    status.innerText = "â³ Uploading product...";
    status.className = "text-blue-600 font-medium";

    const res = await fetch("/api/products/", {
      method: "POST",
      headers: {
        Authorization: "Bearer " + token
      },
      body: formData
    });

    const data = await res.json();

    if (res.ok) {
      status.innerText = "âœ… Product uploaded successfully!";
      status.className = "text-green-600";
      setTimeout(() => {
        window.location.href = "/products/";
      }, 1000);
    } else {
      status.innerText = "âŒ Upload failed: " + (data.detail || JSON.stringify(data));
      status.className = "text-red-600";
    }
  };
</script>
{% endblock %}
